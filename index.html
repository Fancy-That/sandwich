<!DOCTYPE html>
<html>
	<head>
			<title>
				The Special Sandwich Shop
			</title>
			<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
			<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-route.js"></script>
			<link rel="stylesheet"href="https://www.w3schools.com/w3css/4/w3.css"/>
			<link rel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
			<link href="https://fonts.googleapis.com/css?family=Roboto"rel="stylesheet"/>
			<link rel="stylesheet"href="./style.css"/>

	</head>
	<body>
		<div ng-app="tApp" ng-controller="tController">
			<div class="w3-display-container fa fa-shopping-basket w3-xxlarge w3-right w3-button" ng-click="openModal('basket')">
				<div class = "w3-display-bottomright w3-text-black w3-red w3-circle w3-padding-2" style="font-size: 3vh; margin-right: 2vh; {{sandwiches.length<10?'padding-left: 1vh; padding-right: 1vh;':''}}" ng-show="sandwiches.length">
					{{numBasketItems()}}
				</div>

			</div>
			<span class="fa fa-home w3-xxlarge w3-circle w3-right w3-button" ng-click="changePage('main')">
			</span>
			<div ng-show="page.main">
				<div class="w3-xxlarge w3-center">
		            The Special Sandwich Shop
		        </div>
		        <button style="height:30vh;width:60vw;margin-left:20vw" class="w3-col" ng-click="changePage('signature')">
		            Chose from our signature sandwiches
		        </button>
		        <p class="w3-col w3-center">
		            or
		        </p>
		        <button style="height:30vh;width:60vw;margin-left:20vw" class="w3-col" ng-click="changePage('custom')">
		            Make your own custom sandwiches
		        </button>
			</div>
			<div ng-show="page.signature">
				<div class="w3-panel w3-half w3-row">
					<div  ng-repeat="x in signature.data">
						<div class="w3-button w3-col  w3-card {{signature.index==$index?'w3-grey':''}}" style="height:15%" ng-click="$parent.signature.changeIndex($index)">
							<div class="w3-display-container">
								<img src="{{x.image}}" style="height:15vh" class="w3-image"/>
								<div class="w3-display-topleft">
									{{x.name}}
								</div>
								<div class="w3-display-topright">
									{{x.price | currency:"£"}}
								</div>
								<div class="w3-display-bottomright">
									<img ng-show="x.vegetarian" src="http://images.sasongsmat.nu/vegetarianmark/vegetarian-mark.svg" style="width: 3vh;height: 3vh;margin-bottom:3vh;"/>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="w3-half w3-panel w3-card-4" ng-hide="signature.index==-1">
					<div class="w3-row">
						Ingredients:
						<p class="w3-small w3-card-4">
							{{signature.salad?"Salad"+signature.data[signature.index].ingredients.substring(signature.data[signature.index].ingredients.indexOf(':')):signature.data[signature.index].ingredients}}
							<img ng-show="signature.data[signature.index].vegetarian" src="http://images.sasongsmat.nu/vegetarianmark/vegetarian-mark.svg" style="width: 3vh;height: 3vh;"/>
						</p>
						Description:
						<p ng-bind-html="signature.data[signature.index].description">
						</p>
					</div>
					<div class="w3-center">
						<div class="w3-button fa fa-minus" ng-click="signature.removeSandwich()">
						</div>
						<input style="width:50px;" ng-model="signature.num" class="w3-center">
						</input>
						<div class="w3-button fa fa-plus" ng-click="signature.addSandwich()">
						</div>
						{{signature.data[signature.index].price * numSandwiches | currency:"£"}}
						<div class="w3-col">
							<div class="w3-button" ng-click="addToBasket(signature.toSandwich())">
								Add to basket
							</div>
							<input class="w3-check" type="checkbox" ng-model="signature.salad">
								Salad
							</input>
						</div>
					</div>
				</div>
				<div class="w3-half w3-panel w3-card-4" ng-show="signature.index==-1">
					<div class="w3-row">
						Select a sandwich to see its yummy insides.
					</div>
				</div>
			</div>
			<div ng-show="page.custom" class="w3-center">
				<div class="w3-xxlarge">
					Custom Sandwiches
				</div>
				<div>
					<div class="w3-bar">
						<div class="w3-bar-item w3-button {{custom.index==0?'w3-black w3-text-white':''}}" ng-click="custom.index=0">
							Bread
						</div>
						<div class="w3-bar-item w3-button {{custom.index==1?'w3-black w3-text-white':''}}" ng-click="custom.index=1">
							Spread
						</div>
						<div class="w3-bar-item w3-button {{custom.index==2?'w3-black w3-text-white':''}}" ng-click="custom.index=2">
							Main
						</div>
						<div class="w3-bar-item w3-button {{custom.index==3?'w3-black w3-text-white':''}}" ng-click="custom.index=3">
							Add-ins
						</div>
						<div class="w3-bar-item w3-button {{custom.index==4?'w3-black w3-text-white':''}}" ng-click="custom.index=4">
							Premium Add-ins
						</div>
					</div>
					<div class="w3-card-4 w3-half" ng-model="custom.data[custom.index]" style="margin-left:25vw;">
						<div ng-repeat="x in custom.data[custom.index]">
							<div class="w3-display-container customImage" style="width:15vh;" ng-click="custom.select($index)">
								<img class="w3-hover-grayscale w3-image {{custom.sandwich[custom.index]==$index?'w3-grayscale':''}}" src="{{x.image}}" style="width: 15vh; height: 15vh;" />
								<div class="w3-display-bottommiddle w3-container customImageText" style="display:block;">
									{{x.name}}
								</div>
								<div class="w3-display-middle w3-jumbo w3-green w3-circle fa fa-check" style="{{custom.sandwich[custom.index]==$index?'':'display:none;'}}">
								</div>
								<div class="w3-display-middle customAddIn" style="{{isArray(custom.sandwich[custom.index])?'':'display: none;'}}">
									<div class="w3-button fa fa-plus" ng-click="custom.addAddin($index)">
									</div>
									<input ng-model="custom.sandwich[custom.index][$index]" style="width:5vw; margin:0;" class="w3-center w3-white" disabled>
									</input>
									<div class="w3-button fa fa-minus" ng-click="custom.removeAddin($index)">
									</div>
								</div>
							</div>
						</div>
						<div class="w3-card-4 w3-right w3-xlarge" style="margin-right: 4px;">
							Current Cost: {{custom.current().price() | currency:"£"}}
							<div class="w3-grey w3-medium" style="font-style: italic;">
								Sandwiches are £1.00
								<div>
									+ £0.50 for add-ins
								</div>
								<div>
									+ £0.25 for premium add-ins
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="w3-button" ng-click="addToBasket(custom.toSandwich())">
					Add To Basket
				</div>
			</div>
			<div id="basket" class="w3-modal">
				<div class="w3-modal-content w3-round w3-animate-zoom">
					<span class="w3-button w3-round w3-right" ng-click="closeModal('basket')">
						&times;
					</span>
					<div class="w3-row">
						<div class="w3-jumbo w3-half">
							Basket
						</div>
						<div class="w3-half">
							<label>
								Loyalty Card:
							</label>
							<input tabindex="1" type="number" ng-model="card[0]" style="width:30px;" min="0" max="9">
							</input>
							<input tabindex="1" type="number" ng-model="card[1]" style="width:30px;" min="0" max="9">
							</input>
							<input tabindex="1" type="number" ng-model="card[2]" style="width:30px;" min="0" max="9">
							</input>
							<input tabindex="1" type="number" ng-model="card[3]" style="width:30px;" min="0" max="9">
							</input>
							<div>
								<span ng-repeat="x in starNum()">
									<span class="fa fa-star w3-text-{{loyalty[cardString()]>$index?'yellow':loyalty[cardString()]==$index&&sandwiches.length?'green':'grey'}}">
									</span>
								</span>
							</div>
						</div>
					</div>
					<div class="w3-container">
						<div>
							<ul class="w3-ul">
								<li ng-repeat="x in sandwiches">
									{{x.print()}} {{x.signature?x.data[1]?"(Salad)":"(Sandwich)":""}}
									<span class="w3-text-grey w3-small">
										{{x.price() | currency:"£"}}
									</span>
									<div class="w3-right">
										<div class="w3-button fa fa-minus" ng-click="x.remove()">
										</div>
										<input style="width:50px;" ng-model="x.data[x.data.length-1]" disabled class="w3-white w3-center">
										</input>
										<div class="w3-button fa fa-plus" ng-click="x.add()">
										</div>
										<span>
											{{x.data[x.data.length-1] * x.price() | currency:"£"}}
										</span>
										<span class="w3-button" ng-click="$parent.sandwiches.splice($index, 1);">
											&times;
										</span>
									</div>
									<div class="w3-card-2 w3-tiny" style="font-style:italic;">
										{{x.ingredients()}}
									</div>
								</li>
								<div ng-hide="sandwiches.length" style="font-style:italic;">
									The basket is currently empty!
								</div>
								<div ng-show="sandwiches.length" class="w3-container">
									<div class="w3-button w3-left w3-green" ng-click="submitOrder()">
										Submit
									</div>
									<div class="w3-right">

									</div>
									<div class="w3-right w3-xlarge">
										<div class="w3-small">
											{{loyalty[cardString()]==9?"Loyalty: " + (minItemPrice() + totalCost() | currency:"£") + " - " + (minItemPrice() | currency:"£"):""}}
										</div>
										Total Cost: {{totalCost() | currency:"£"}}
									</div>
								</div>
							</ul>
						</div>
					</div>
				</div>
			</div>
			<div id="sent" class="w3-modal">
				<div class="w3-modal-content w3-round w3-animate-zoom">
					<span class="w3-button w3-round w3-right" ng-click="closeModal('sent')">
						&times;
					</span>
					<div class="w3-jumbo w3-content">
						Your order has been sent
					</div>
				</div>
			</div>
		</div>
		<script>
			var app = angular.module("tApp", []);
			app.controller("tController", function($scope, $sce, $interval){
				$scope.sandwiches = [];
				$scope.card = [0,0,0,0];
				$scope.cardString=()=>""+$scope.card[0]+$scope.card[1]+$scope.card[2]+$scope.card[3];
				$scope.starNum = function() {
					return new Array(1,2,3,4,5,6,7,8,9,10);
				};
				$scope.loyalty={
					"4321":2,
					"1111":0,
					"1234":7,
					"9999":9
				};
				$scope.totalCost = function() {
					var out = 0;
					for (var i = $scope.sandwiches.length; i;) {
						if ($scope.sandwiches[--i].signature)
							out += $scope.signature.data[$scope.sandwiches[i].data[0]].price * $scope.sandwiches[i].data[2];
						else
							out += $scope.sandwiches[i].price() * $scope.sandwiches[i].data[6];
					}
					if ($scope.loyalty[$scope.cardString()])
						out -= $scope.minItemPrice();
					return out;
				};
				function Sandwich(data, signature = false) {
					this.data=data;
					this.signature=signature;
					this.basePrice=1;
					this.price=()=>{
						if (this.signature)
							return $scope.signature.data[this.data[0]].price;
						var price = this.basePrice;
						for (var i = 5; i;)
							price+= this.data[3][--i]*0.25;
						for (var i = 7; i;)
							price+= this.data[4][--i]*0.5;
						return price;
					};
					this.add=()=>this.data[this.data.length-1]<99?this.data[this.data.length-1]++:0;
					this.remove=()=>this.data[this.data.length-1]>1?this.data[this.data.length-1]--:0;
					this.print=()=>this.signature?$scope.signature.data[this.data[0]].name:"Custom "+this.data[5];
					this.ingredients=()=>{
						if (signature) {
							_ = $scope.signature.data[this.data[0]].ingredients;
								return this.data[1]?"Salad" + _.substring(_.indexOf(':')) : _;
						}
						var out = "";
						for (var i = 0; i < 3; i++) {
							if (this.data[i]==-1)
								continue;
							out += $scope.custom.data[i][this.data[i]].name + ", ";
						}
						var addins = "";
						for (var i = 0; i < 5; i++) {
							if (this.data[3][i]==0)
								continue;
							addins += $scope.custom.data[3][i].name + " (x" + this.data[3][i] + "), ";
						}

						for (var i = 0; i < 7; i++) {
							if (this.data[4][i]==0)
								continue;
							addins += $scope.custom.data[4][i].name + " (x" + this.data[4][i] + "), ";
						}
						if (addins=="")
							addins += "No addins";
						else
							addins = addins.slice(0, addins.length-2);
						return out + addins;
					};
				};

				$scope.signature = {
					index:-1,
					num:1,
					salad:0,
					addSandwich:function() {
						this.num>98?0:this.num++;
					},
					removeSandwich:function() {
						this.num>1?this.num--:0;
					},
					changeIndex:function(i){
						this.index = i;
						this.num = 1;
						this.salad = 0;
					},
					data:[
						{name:"Egg Salad Relish",
						ingredients:"White Bread: Egg Mayonnaise, Sliced Radishes, Chopped Oil-Cured Olives, Fresh Coriander",
						description:$sce.trustAsHtml("Enjoy our Egg Salad Relish which comes with <b>egg mayonnaise</b>, <b>sliced radishes</b>, <b>chopped oil-cured olives</b> and <b>fresh coriander</b> inside our freshly baked <b>white bread</b>."),
						price:1,
						vegetarian:true,
						image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png"},
						{name:"The Pegasus",
						ingredients:"Baguette: Roast Beef, Sour Cream, Raw Mushrooms",
						description:$sce.trustAsHtml("Turn yourself into a Greek god with our signature sandwich: The Pegasus.  A 6 inch or footlong sub, stuffed with <b>roast beef</b>, <b>sour cream</b> and <b>raw mushrooms</b>."),
						price:2,
						vegetarian:false,
						image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png"},
						{name:"The Gallant",
						ingredients:"Wholewheat Bread: Turkey, Bacon, Avocado, Cranberry Mayonnaise",
						description:$sce.trustAsHtml("Become the bold and brave hero you’ve only dreamt to be with the Gallant. <b>Whole-wheat bread</b> with <b>bacon</b>, <b>turkey</b>, <b>avocado</b> and <b>cranberry mayonnaise.</b>"),
						price:3,
						vegetarian:false,
						image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png"},
						{name:"Angus & Tessie's Skipanon Sing-A-Long",
						ingredients:"White Bread: Tuna, Mustard, Fresh Herb Relish",
						description:$sce.trustAsHtml("Get a taste of Portland and try our Angus & Tessie’s Skipanon Sing-A-Long. It comes with <b>tuna</b> and <b>mustard</b> with <b>fresh herb relish</b> inside our freshly baked <b>white bread.</b>"),
						price:4,
						vegetarian:false,
						image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png"},
						{name:"The Yellow Elephant",
						ingredients:"Pita: Peanut Butter, Honey, Banana, Toasted Sesame Seeds",
						description:$sce.trustAsHtml("Try the Yellow Elephant apart of our Signature Selection. Pita bread filled with <b>honey</b>, <b>bananas</b> and <b>toasted sesame seeds</b>, which all come together to form something else entirely."),
						price:5,
						vegetarian:true,
						image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png"}
					],
					toSandwich:function() {
						var x = new Sandwich([this.index, this.salad, this.num], true);
						this.num = 1;
						this.salad = 0;
						return x;
					}
				};

				$scope.custom = {
					index:0,
					num:1,
					default:[-1,-1,-1,[0,0,0,0,0],[0,0,0,0,0,0,0],0,1],
					sandwich:[-1,-1,-1,[0,0,0,0,0],[0,0,0,0,0,0,0],0,1],
					data:[[
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"White"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Wholewheat"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Baguette"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Pita"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png", name:"Salad"}],[
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Butter"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Mayonnaise"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Margarine"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Vegannaise"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Peanut Butter"}],[
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Turkey"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Roast Beef"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Tuna"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Eggs"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Tempeh"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Griddled Broccoli"}],[
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Cucumber"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Lettuce"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Tomato"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Raw Mushrooms"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Alfalfa Sprouts"}],[
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Cheddar"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:" Brie"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Herb Cream-Cheese"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Bacon"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Roasted Red Pepper"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Guacamole"},
						{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Red_X.svg/2000px-Red_X.svg.png",name:"Anchovies"}
					]],
					select:function(i) {
						return $scope.isArray(this.sandwich[this.index])?0:this.sandwich[this.index]=i;
					},
					addAddin:function(i) {
						this.sandwich[this.index][i]>98?0:this.sandwich[this.index][i]++;
					},
					removeAddin:function(i) {
						this.sandwich[this.index][i]?this.sandwich[this.index][i]--:0;
					},
					current:function() {
						return new Sandwich(this.sandwich.slice());
					},
					toSandwich:function() {
						this.sandwich[5]=this.num++;
						var x = this.sandwich.slice();
						this.sandwich = this.default.slice();
						return new Sandwich(x);
					}
				};

				$scope.page = {main:true,signature:false,custom:false};

				$scope.openModal=($)=>document.getElementById($).style.display='block';
				$scope.closeModal=($)=>document.getElementById($).style.display='none';

				$scope.addToBasket = function(sandwich) {
					if (!sandwich.data[sandwich.data.length-1])
						return;
					var same = false;
					for (var j = $scope.sandwiches.length; j;) {
						if ($scope.sandwiches[--j].data.length == sandwich.data.length) {
							if (sandwich.signature) {
								if ($scope.sandwiches[j].signature)
									if (sandwich.data[0] == $scope.sandwiches[j].data[0] && sandwich.data[1] == $scope.sandwiches[j].data[1])
										return $scope.sandwiches[j].data[2]+=sandwich.data[2];
							} else {
							same = true;
							for (var i = 3; i;)
								if ($scope.sandwiches[j].data[--i] != sandwich.data[i])
									same = false;
							for (var i = 5; i;)
								if ($scope.sandwiches[j].data[3][--i] != sandwich.data[3][i])
									same = false;
							for (var i = 6; i;)
								if ($scope.sandwiches[j].data[4][--i] != sandwich.data[4][i])
									same = false;
							if(same)
								return $scope.sandwiches[j].data[sandwich.data.length-1]+=sandwich.data[sandwich.data.length-1];
							}
						}
					}

					$scope.sandwiches.push(sandwich);
				};

				$scope.numBasketItems = function() {
					var $=0;
					for (var i = $scope.sandwiches.length; i;)
						$+=$scope.sandwiches[--i].data[$scope.sandwiches[i].signature?2:6];
					return $>99?99:$;
				};

				$scope.minItemPrice = function() {
					var m = $scope.sandwiches[$scope.sandwiches.length - 1].price();
					for (var i = $scope.sandwiches.length - 1; i;)
						m > $scope.sandwiches[--i].price() ? m = $scope.sandwiches[i].price() : 0;
					return m;
				};

				$scope.changePage = function(page) {
					$scope.page.main = page == "main";
					$scope.page.signature = page == "signature";
					$scope.page.custom = page == "custom";
				};

				$scope.submitOrder = function() {
					$scope.closeModal('basket');
					$scope.openModal('sent');
					$scope.sandwiches = [];
				};

				$interval(function()
				{
					//console.log($scope.loyalty[$scope.cardString()]);
				},1000);


				$scope.isArray = function(x) {
					return Array.isArray(x);
				};
			});


			var basket = document.getElementById('basket');
			window.onclick = function(event) {
  			if (event.target == basket) {
    			basket.style.display = "none";
  			}
}
		</script>
	</body>
</html>
